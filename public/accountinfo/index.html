<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Account</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui, Arial, sans-serif;
  background:#f4eee3;
  color:#1f2933;
}
.card{
  max-width:850px;
  margin:50px auto;
  background:#fff;
  padding:30px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h1{margin-top:0;text-align:center}
.field{margin:12px 0;font-size:17px}
.label{font-weight:600}
textarea{
  width:100%;
  min-height:140px;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  resize:vertical;
  font-size:15px;
}
button{
  margin-top:15px;
  padding:12px 18px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.save{background:#1f4e79;color:white}
.reset{background:#444;color:white;margin-left:10px}
.logout{background:#b22222;color:white;width:100%;margin-top:25px}
.status{margin-top:10px;color:green}
</style>
</head>

<body>

<div class="card">
<h1>My Account</h1>

<div class="field"><span class="label">Email:</span> <span id="email"></span></div>
<div class="field"><span class="label">UID:</span> <span id="uid"></span></div>
<div class="field"><span class="label">Full Name:</span> <span id="fullName"></span></div>
<div class="field"><span class="label">Phone:</span> <span id="phone"></span></div>
<div class="field"><span class="label">Account Type:</span> <span id="accountType"></span></div>
<div class="field"><span class="label">Auth Role:</span> <span id="authRole"></span></div>

<h3>Notes</h3>
<textarea id="notes"></textarea>

<button class="save" id="saveBtn">Save Notes</button>
<button class="reset" id="resetBtn">Reset Password</button>

<div class="status" id="status"></div>

<button class="logout" id="logoutBtn">Log Out</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ” REPLACE WITH YOUR CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyD5qUHa2JuQ3iI7U3DrX7JDyhx76PGzhxM",
  authDomain: "troop-248.firebaseapp.com",
  projectId: "troop-248",
  storageBucket: "troop-248.firebasestorage.app",
  messagingSenderId: "925363875752",
  appId: "1:925363875752:web:0b001c1a7a09fb8232f79d",
  measurementId: "G-NY75GX5TBH"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const emailEl = document.getElementById("email");
const uidEl = document.getElementById("uid");
const fullNameEl = document.getElementById("fullName");
const phoneEl = document.getElementById("phone");
const accountTypeEl = document.getElementById("accountType");
const authRoleEl = document.getElementById("authRole");
const notesEl = document.getElementById("notes");
const statusEl = document.getElementById("status");

const saveBtn = document.getElementById("saveBtn");
const resetBtn = document.getElementById("resetBtn");
const logoutBtn = document.getElementById("logoutBtn");

let currentUid = null;

onAuthStateChanged(auth, async (user) => {
  if(!user){
    window.location.href="/login.html";
    return;
  }

  currentUid = user.uid;
  uidEl.textContent = user.uid;

  const ref = doc(db,"accountInfo",user.uid);
  const snap = await getDoc(ref);

  if(!snap.exists()){
    alert("No accountInfo document found");
    return;
  }

  const d = snap.data();

  emailEl.textContent = d.email || "";
  fullNameEl.textContent = d.fullName || "";
  phoneEl.textContent = d.phone || "";
  accountTypeEl.textContent = d.accountType || "";
  authRoleEl.textContent = d.authRole || "";
  notesEl.value = d.notes || "";
});

/* Save notes */
saveBtn.onclick = async () => {
  if(!currentUid) return;

  const ref = doc(db,"accountInfo",currentUid);
  await updateDoc(ref,{
    notes: notesEl.value
  });

  statusEl.textContent="Notes saved.";
  setTimeout(()=>statusEl.textContent="",2000);
};

/* Reset password */
resetBtn.onclick = async () => {
  const user = auth.currentUser;
  if(!user) return;

  await sendPasswordResetEmail(auth, user.email);
  alert("Password reset email sent.");
};

/* Logout */
logoutBtn.onclick = async () => {
  await signOut(auth);
  window.location.href="/login.html";
};
</script>

</body>
</html>
